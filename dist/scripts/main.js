function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}this.MovieSearch=this.MovieSearch||{},this.MovieSearch.templates=this.MovieSearch.templates||{},this.MovieSearch.templates.detail=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,a,n){var l,i=e.helperMissing,r="function",o=this.escapeExpression;return'\n<div class="detail-view row">\n\t<div class="back-arrow" id="go-back"><i class="glyphicon glyphicon-arrow-left"></i></div>\n\t<div class="col-xs-12 text-center col-md-2 col-md-offset-1">\n\t\t<img class="detail-view-img" src="'+o((l=null!=(l=e.Poster||(null!=t?t.Poster:t))?l:i,typeof l===r?l.call(t,{name:"Poster",hash:{},data:n}):l))+'" alt="'+o((l=null!=(l=e.Title||(null!=t?t.Title:t))?l:i,typeof l===r?l.call(t,{name:"Title",hash:{},data:n}):l))+' - Poster">\n\t</div>\n\t<div class="col-md-8">\n\t\t<header>\n\t\t\t<h1 class="detail-view-title">'+o((l=null!=(l=e.Title||(null!=t?t.Title:t))?l:i,typeof l===r?l.call(t,{name:"Title",hash:{},data:n}):l))+'</h1>\n\t\t\t\n\t\t\t<p class="detail-view-text"><span class="capitalize">'+o((l=null!=(l=e.Type||(null!=t?t.Type:t))?l:i,typeof l===r?l.call(t,{name:"Type",hash:{},data:n}):l))+"</span> - "+o((l=null!=(l=e.Year||(null!=t?t.Year:t))?l:i,typeof l===r?l.call(t,{name:"Year",hash:{},data:n}):l))+"</p>\n\t\t\t<p>"+o((l=null!=(l=e.Genre||(null!=t?t.Genre:t))?l:i,typeof l===r?l.call(t,{name:"Genre",hash:{},data:n}):l))+"</p>\n\t\t</header>\n\t\t<section>\n\t\t\t<p>"+o((l=null!=(l=e.Plot||(null!=t?t.Plot:t))?l:i,typeof l===r?l.call(t,{name:"Plot",hash:{},data:n}):l))+"</p>\n\t\t\t<table>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>Director:</td>\n\t\t\t\t\t<td>"+o((l=null!=(l=e.Director||(null!=t?t.Director:t))?l:i,typeof l===r?l.call(t,{name:"Director",hash:{},data:n}):l))+"</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>Writer:</td>\n\t\t\t\t\t<td>"+o((l=null!=(l=e.Writer||(null!=t?t.Writer:t))?l:i,typeof l===r?l.call(t,{name:"Writer",hash:{},data:n}):l))+"</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>Cast:</td>\n\t\t\t\t\t<td>"+o((l=null!=(l=e.Actors||(null!=t?t.Actors:t))?l:i,typeof l===r?l.call(t,{name:"Actors",hash:{},data:n}):l))+'</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t</section>\n\t\t<footer>\n\t\t\t<p><i class="glyphicon glyphicon-star"></i>IMDB rating: <span class="badge">'+o((l=null!=(l=e.imdbRating||(null!=t?t.imdbRating:t))?l:i,typeof l===r?l.call(t,{name:"imdbRating",hash:{},data:n}):l))+'</span></p>\n\t\t\t<a target="self" href="http://www.imdb.com/title/'+o((l=null!=(l=e.imdbID||(null!=t?t.imdbID:t))?l:i,typeof l===r?l.call(t,{name:"imdbID",hash:{},data:n}):l))+'" class="btn btn-default">IMDB</a>\n\t\t</footer>\n\t\t\n\t</div>\n\t\n</div>\n'},useData:!0}),this.MovieSearch=this.MovieSearch||{},this.MovieSearch.templates=this.MovieSearch.templates||{},this.MovieSearch.templates.movie=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,a,n){var l,i=e.helperMissing,r="function",o=this.escapeExpression;return'<div class="col-md-4 col-lg-2 movie-element">\n\t<a href="#/id/'+o((l=null!=(l=e.imdbID||(null!=t?t.imdbID:t))?l:i,typeof l===r?l.call(t,{name:"imdbID",hash:{},data:n}):l))+'">\n\t\t<img src="'+o((l=null!=(l=e.Poster||(null!=t?t.Poster:t))?l:i,typeof l===r?l.call(t,{name:"Poster",hash:{},data:n}):l))+'" alt="'+o((l=null!=(l=e.Title||(null!=t?t.Title:t))?l:i,typeof l===r?l.call(t,{name:"Title",hash:{},data:n}):l))+'">\n\t\t<div class="movie-info">\n\t\t\t<h2>'+o((l=null!=(l=e.Title||(null!=t?t.Title:t))?l:i,typeof l===r?l.call(t,{name:"Title",hash:{},data:n}):l))+"</h2>\n\t\t\t<div>\n\t\t\t\t<span>"+o((l=null!=(l=e.Type||(null!=t?t.Type:t))?l:i,typeof l===r?l.call(t,{name:"Type",hash:{},data:n}):l))+" - "+o((l=null!=(l=e.Year||(null!=t?t.Year:t))?l:i,typeof l===r?l.call(t,{name:"Year",hash:{},data:n}):l))+"</span>\n\t\t\t</div>\n\t\t</div>\n\t</a>\n</div>"},useData:!0}),this.MovieSearch=this.MovieSearch||{},this.MovieSearch.templates=this.MovieSearch.templates||{},this.MovieSearch.templates.start=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,a,n){return'<div class="main-view">\n\t<hr class="main-view-decorator">\n\t<h1 class="main-view-brand">MovieSearch</h1>\n\t\n\t<p class="main-view-text">Search movies, series, games and other contents on IMDB</p>\n\t<hr class="main-view-decorator">\n</div>'},useData:!0}),Handlebars.registerPartial("movie",Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,a,n){var l,i=e.helperMissing,r="function",o=this.escapeExpression;return'<div class="col-md-2 movie-element">\n\t\t<a href="#/id/'+o((l=null!=(l=e.imdbID||(null!=t?t.imdbID:t))?l:i,typeof l===r?l.call(t,{name:"imdbID",hash:{},data:n}):l))+'">\n\t\t\t<img src="'+o((l=null!=(l=e.Poster||(null!=t?t.Poster:t))?l:i,typeof l===r?l.call(t,{name:"Poster",hash:{},data:n}):l))+'" alt="'+o((l=null!=(l=e.Title||(null!=t?t.Title:t))?l:i,typeof l===r?l.call(t,{name:"Title",hash:{},data:n}):l))+'">\n\t\t\t<div class="movie-info">\n\t\t\t\t<h2>'+o((l=null!=(l=e.Title||(null!=t?t.Title:t))?l:i,typeof l===r?l.call(t,{name:"Title",hash:{},data:n}):l))+"</h2>\n\t\t\t\t<div>\n\t\t\t\t\t<span>"+o((l=null!=(l=e.Type||(null!=t?t.Type:t))?l:i,typeof l===r?l.call(t,{name:"Type",hash:{},data:n}):l))+" - "+o((l=null!=(l=e.Year||(null!=t?t.Year:t))?l:i,typeof l===r?l.call(t,{name:"Year",hash:{},data:n}):l))+"</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</a>\n</div>"},useData:!0}));var _createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}(),CtrlGlobal=function(){function t(){_classCallCheck(this,t),this.view=new View,this.listenSearch()}return _createClass(t,[{key:"listenSearch",value:function(){$("#searchform").submit(function(t){t.preventDefault();var e=$("#query").val();for(e=e.split(" ").join("+");"+"==e[e.length-1];)e=e.slice(0,-1);window.location.replace("/#/search/"+e)})}}]),t}(),CtrlHome=function t(){_classCallCheck(this,t),this.view=new ViewHome},CtrlSearch=function(){function t(e){_classCallCheck(this,t),this.view=new ViewSearch,this.query=e,this.lastPage=1,this.sendQuery(!0)}return _createClass(t,[{key:"sendQuery",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=/^\s+$/;if(this.query&&!a.test(this.query)){var n="http://www.omdbapi.com/?s="+this.query;$.ajax({method:"GET",url:n,success:function(a){"True"==a.Response?(a.Search.forEach(function(t){"N/A"==t.Poster&&(t.Poster="./images/noposter.png")}),e||t.view.hidePreloader(),t.view.addMovies(a.Search)):(t.view&&t.view.hidePreloader(),console.log(a.Error)),t.listenScroll(),t.listenClick()},error:function(e,a,n){t.view.hidePreloader(),console.log(n)}})}}},{key:"listenScroll",value:function(){var t=this;$(window).on("scroll",function(){if($(window).scrollTop()+$(window).height()==$(document).height()){if($(window).off("scroll"),t.view.showPreloader(),t.lastPage++,/&page=/.test(t.query)){var e=t.query.split("&page=");t.query=e[0]+"&page="+t.lastPage}else t.query+="&page="+t.lastPage;t.sendQuery()}})}},{key:"listenClick",value:function(){$(document).on("click",".movie-element a",function(){$(window).off("scroll")})}}]),t}(),CtrlDetail=function(){function t(e){_classCallCheck(this,t),this.view=new ViewMovie,this.id=e,this.sendQuery()}return _createClass(t,[{key:"sendQuery",value:function(){var t=this,e=/^\s+$/;if(this.id&&!e.test(this.id)&&" "!=this.id[this.id.length-1]){var a="http://www.omdbapi.com/?i="+this.id;$.ajax({method:"GET",url:a,success:function(e){"True"==e.Response?("N/A"==e.Poster&&(e.Poster="./images/noposter.png"),t.view.renderContent(null,e),t.listenBack()):console.log(e.Error)},error:function(e,a,n){t.view.hidePreloader(),console.log(n)}})}}},{key:"listenBack",value:function(){$(document).on("click","#go-back",function(){window.history.back(),$(document).off("click")})}}]),t}(),_createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}(),View=function(){function t(){_classCallCheck(this,t),this.searchbox=$("#query"),this.renderBoard=$("[data-app]")}return _createClass(t,[{key:"renderContent",value:function(t,e){var a=e?e:{};this.renderBoard.html(this.template(t,a))}},{key:"addContent",value:function(t,e){var a=e?e:{};this.renderBoard.append(this.template(t,a))}},{key:"clearPrevContent",value:function(){this.renderBoard.html("")}}]),t}(),ViewHome=function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.renderContent(t.template()),t}return _inherits(e,t),_createClass(e,[{key:"template",value:function(t){return MovieSearch.templates.start(t)}}]),e}(View),ViewSearch=function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.clearPrevContent(),t}return _inherits(e,t),_createClass(e,[{key:"template",value:function(t,e){return MovieSearch.templates.movie(e)}},{key:"addMovies",value:function(t){var e=this,a=0,n=setInterval(function(){var l=t[a];e.addContent("movie",l);var i=$(".movie-element:last-child"),r=$(".movie-element:last-child").index(),o=window.innerWidth;o>1200&&(0!==r&&r%5!==0||i.addClass("col-md-offset-1")),i.css("opacity",0),i.fadeTo("slow",1),a++,a>=t.length&&clearInterval(n)},100)}},{key:"showPreloader",value:function(){$("#preloader").show()}},{key:"hidePreloader",value:function(){$("#preloader").hide()}}]),e}(View),ViewMovie=function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.clearPrevContent(),t.back=$("#go-back"),t}return _inherits(e,t),_createClass(e,[{key:"template",value:function(t,e){return MovieSearch.templates.detail(e)}}]),e}(View),subctrl;Path.map("#/").to(function(){subctrl=new CtrlHome}),Path.map("#/search(/:query)").to(function(){subctrl=new CtrlSearch(this.params.query)}),Path.map("#/id(/:movieId)").to(function(){subctrl=new CtrlDetail(this.params.movieId)}),Path.root("/"),Path.listen();var ctrl=new CtrlGlobal;